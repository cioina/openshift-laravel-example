((t,e)=>{var a=!0;(a=t&&void 0!==t.umd?t.umd:a)&&"object"==typeof exports?module.exports=e(require("jquery"),require("handlebars")):a&&"function"==typeof define&&define.amd?define("alpaca",["jquery","handlebars"],e):t.Alpaca=e(0,t.Handlebars)})(this,function(t,e){var a,d,p,n,i;return this.HandlebarsPrecompiled=this.HandlebarsPrecompiled||{},this.HandlebarsPrecompiled["web-display-advanced"]=this.HandlebarsPrecompiled["web-display-advanced"]||{},this.HandlebarsPrecompiled["web-display-advanced"]["container-array-item"]=e.template({1:function(t,e,a,n,i){return""},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},o='<script type="text/x-handlebars-template">\r\n\r\n    <div>\r\n        ',l=null!=(l=r(a,"itemField")||(null!=e?r(e,"itemField"):e))?l:t.hooks.helperMissing,i={name:"itemField",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:4,column:8},end:{line:4,column:36}}},l="function"==typeof l?l.call(null!=e?e:t.nullContext||{},i):l;return null!=(l=r(a,"itemField")?l:t.hooks.blockHelperMissing.call(e,l,i))&&(o+=l),o+"\r\n    </div>\r\n\r\n<\/script>\r\n"},useData:!0}),this.HandlebarsPrecompiled["web-display-advanced"]["container-array"]=e.template({1:function(t,e,a,n,i){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},o="\r\n            ",l=null!=(l=r(a,"item")||(null!=e?r(e,"item"):e))?l:t.hooks.helperMissing,i={name:"item",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i,loc:{start:{line:7,column:12},end:{line:7,column:30}}},l="function"==typeof l?l.call(null!=e?e:t.nullContext||{},i):l;return null!=(l=r(a,"item")?l:t.hooks.blockHelperMissing.call(e,l,i))&&(o+=l),o+"\r\n\r\n"},2:function(t,e,a,n,i){return""},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<script type="text/x-handlebars-template">\r\n\r\n    <div>\r\n\r\n'+(null!=(a=r(a,"each").call(null!=e?e:t.nullContext||{},null!=e?r(e,"items"):e,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:5,column:8},end:{line:9,column:17}}}))?a:"")+"\r\n    </div>\r\n\r\n<\/script>"},useData:!0}),this.HandlebarsPrecompiled["web-display-advanced"]["control-hidden"]=e.template({compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){return'<script type="text/x-handlebars-template">\r\n\r\n<\/script>'},useData:!0}),this.HandlebarsPrecompiled=this.HandlebarsPrecompiled||{},this.HandlebarsPrecompiled["web-edit-advanced"]=this.HandlebarsPrecompiled["web-edit-advanced"]||{},this.HandlebarsPrecompiled["web-edit-advanced"]["container-array-item"]=e.template({1:function(t,e,a,n,i){var r=null!=e?e:t.nullContext||{},o=t.hooks.helperMissing,l="function",s=t.hooks.blockHelperMissing,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},d='        <div class="pull-left">\r\n            ',h=null!=(h=c(a,"arrayActionbar")||(null!=e?c(e,"arrayActionbar"):e))?h:o,p={name:"arrayActionbar",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i,loc:{start:{line:6,column:12},end:{line:6,column:50}}},u=typeof h==l?h.call(r,p):h;return null!=(u=c(a,"arrayActionbar")?u:s.call(e,u,p))&&(d+=u),d+='\r\n        </div>\r\n        <div class="pull-right">\r\n            ',h=null!=(h=c(a,"itemField")||(null!=e?c(e,"itemField"):e))?h:o,p={name:"itemField",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i,loc:{start:{line:9,column:12},end:{line:9,column:40}}},u=typeof h==l?h.call(r,p):h,null!=(u=c(a,"itemField")?u:s.call(e,u,p))&&(d+=u),d+'\r\n        </div>\r\n        <div class="clear"></div>\r\n'},2:function(t,e,a,n,i){return""},4:function(t,e,a,n,i){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=(r(a,"compare")||e&&r(e,"compare")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},null!=e?r(e,"actionbarStyle"):e,"right",{name:"compare",hash:{},fn:t.program(5,i,0),inverse:t.program(7,i,0),data:i,loc:{start:{line:13,column:8},end:{line:35,column:20}}}))?a:""},5:function(t,e,a,n,i){var r=null!=e?e:t.nullContext||{},o=t.hooks.helperMissing,l="function",s=t.hooks.blockHelperMissing,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},d='            <div class="pull-left">\r\n                ',h=null!=(h=c(a,"itemField")||(null!=e?c(e,"itemField"):e))?h:o,p={name:"itemField",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i,loc:{start:{line:15,column:16},end:{line:15,column:44}}},u=typeof h==l?h.call(r,p):h;return null!=(u=c(a,"itemField")?u:s.call(e,u,p))&&(d+=u),d+='\r\n            </div>\r\n            <div class="pull-right">\r\n                ',h=null!=(h=c(a,"arrayActionbar")||(null!=e?c(e,"arrayActionbar"):e))?h:o,p={name:"arrayActionbar",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i,loc:{start:{line:18,column:16},end:{line:18,column:54}}},u=typeof h==l?h.call(r,p):h,null!=(u=c(a,"arrayActionbar")?u:s.call(e,u,p))&&(d+=u),d+'\r\n            </div>\r\n            <div class="alpaca-clear"></div>\r\n'},7:function(t,e,a,n,i){var r=null!=e?e:t.nullContext||{},o=t.hooks.helperMissing,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},s="            <div>\r\n\r\n"+(null!=(h=(l(a,"compare")||e&&l(e,"compare")||o).call(r,null!=e?l(e,"actionbarStyle"):e,"top",{name:"compare",hash:{},fn:t.program(8,i,0),inverse:t.noop,data:i,loc:{start:{line:24,column:16},end:{line:26,column:28}}}))?h:"")+"\r\n                ",c=null!=(c=l(a,"itemField")||(null!=e?l(e,"itemField"):e))?c:o,d={name:"itemField",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i,loc:{start:{line:28,column:16},end:{line:28,column:44}}},h="function"==typeof c?c.call(r,d):c;return null!=(h=l(a,"itemField")?h:t.hooks.blockHelperMissing.call(e,h,d))&&(s+=h),s+"\r\n\r\n"+(null!=(h=(l(a,"compare")||e&&l(e,"compare")||o).call(r,null!=e?l(e,"actionbarStyle"):e,"bottom",{name:"compare",hash:{},fn:t.program(8,i,0),inverse:t.noop,data:i,loc:{start:{line:30,column:16},end:{line:32,column:28}}}))?h:"")+"\r\n            </div>\r\n"},8:function(t,e,a,n,i){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},o="                ",l=null!=(l=r(a,"arrayActionbar")||(null!=e?r(e,"arrayActionbar"):e))?l:t.hooks.helperMissing,i={name:"arrayActionbar",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i,loc:{start:{line:25,column:16},end:{line:25,column:54}}},l="function"==typeof l?l.call(null!=e?e:t.nullContext||{},i):l;return null!=(l=r(a,"arrayActionbar")?l:t.hooks.blockHelperMissing.call(e,l,i))&&(o+=l),o+"\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<script type="text/x-handlebars-template">\r\n\r\n    <div>\r\n'+(null!=(a=(r(a,"compare")||e&&r(e,"compare")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},null!=e?r(e,"actionbarStyle"):e,"left",{name:"compare",hash:{},fn:t.program(1,i,0),inverse:t.program(4,i,0),data:i,loc:{start:{line:4,column:4},end:{line:36,column:16}}}))?a:"")+"    </div>\r\n\r\n<\/script>\r\n"},useData:!0}),this.HandlebarsPrecompiled["web-edit-advanced"]["container-array"]=e.template({1:function(t,e,a,n,i){return""},3:function(t,e,a,n,i){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},o="\r\n            ",l=null!=(l=r(a,"item")||(null!=e?r(e,"item"):e))?l:t.hooks.helperMissing,i={name:"item",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:9,column:12},end:{line:9,column:30}}},l="function"==typeof l?l.call(null!=e?e:t.nullContext||{},i):l;return null!=(l=r(a,"item")?l:t.hooks.blockHelperMissing.call(e,l,i))&&(o+=l),o+"\r\n\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r=null!=e?e:t.nullContext||{},o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},l='<script type="text/x-handlebars-template">\r\n\r\n    <div>\r\n\r\n        ',s=null!=(s=o(a,"arrayToolbar")||(null!=e?o(e,"arrayToolbar"):e))?s:t.hooks.helperMissing,c={name:"arrayToolbar",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:5,column:8},end:{line:5,column:42}}},s="function"==typeof s?s.call(r,c):s;return null!=(s=o(a,"arrayToolbar")?s:t.hooks.blockHelperMissing.call(e,s,c))&&(l+=s),l+"\r\n\r\n"+(null!=(s=o(a,"each").call(r,null!=e?o(e,"items"):e,{name:"each",hash:{},fn:t.program(3,i,0),inverse:t.noop,data:i,loc:{start:{line:7,column:8},end:{line:11,column:17}}}))?s:"")+"\r\n    </div>\r\n\r\n<\/script>\r\n"},useData:!0}),this.HandlebarsPrecompiled["web-edit-advanced"]["control-hidden"]=e.template({1:function(t,e,a,n,i){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'name="'+t.escapeExpression("function"==typeof(a=null!=(a=r(a,"name")||(null!=e?r(e,"name"):e))?a:t.hooks.helperMissing)?a.call(null!=e?e:t.nullContext||{},{name:"name",hash:{},data:i,loc:{start:{line:3,column:55},end:{line:3,column:63}}}):a)+'"'},3:function(t,e,a,n,i){var r=t.escapeExpression,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"data-"+r("function"==typeof(a=null!=(a=o(a,"key")||i&&o(i,"key"))?a:t.hooks.helperMissing)?a.call(null!=e?e:t.nullContext||{},{name:"key",hash:{},data:i,loc:{start:{line:3,column:99},end:{line:3,column:107}}}):a)+'="'+r(t.lambda(e,e))+'"'},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r,o=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<script type="text/x-handlebars-template">\r\n\r\n    <input type="hidden" id="'+t.escapeExpression("function"==typeof(r=null!=(r=l(a,"id")||(null!=e?l(e,"id"):e))?r:t.hooks.helperMissing)?r.call(o,{name:"id",hash:{},data:i,loc:{start:{line:3,column:29},end:{line:3,column:35}}}):r)+'" '+(null!=(r=l(a,"if").call(o,null!=e?l(e,"name"):e,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:3,column:37},end:{line:3,column:71}}}))?r:"")+" "+(null!=(r=l(a,"each").call(o,null!=(r=null!=e?l(e,"options"):e)?l(r,"data"):r,{name:"each",hash:{},fn:t.program(3,i,0),inverse:t.noop,data:i,loc:{start:{line:3,column:72},end:{line:3,column:127}}}))?r:"")+"/>\r\n\r\n<\/script>"},useData:!0}),(a=jQuery.alpaca).Fields.HiddenField=a.ControlField.extend({getFieldType:function(){return"hidden"},setup:function(){this.base()},getControlValue:function(){return this._getControlVal(!0)},setValue:function(t){a.isEmpty(t)?this.getControlEl().val(""):this.getControlEl().val(t),this.base(t)},getType:function(){return"string"},getTitle:function(){return"Hidden"},getDescription:function(){return"Field for a hidden HTML input"}}),a.registerFieldClass("hidden",a.Fields.HiddenField),d=jQuery,(p=d.alpaca).Fields.ArrayField=p.ContainerField.extend({getFieldType:function(){return"array"},setup:function(){var r=this,t=(this.base(),r.resolveContainerItemTemplateType());if(!t)return p.throwErrorWithCallback("Unable to find template descriptor for container item: "+r.getFieldType());this.containerItemTemplateDescriptor=r.view.getTemplateDescriptor("container-"+t+"-item",r),this.options.toolbarStyle||(this.options.toolbarStyle=p.isEmpty(this.view.toolbarStyle)?"button":this.view.toolbarStyle),this.options.toolbarStyle||(this.options.toolbarStyle="button"),this.options.actionbarStyle||(this.options.actionbarStyle=p.isEmpty(this.view.actionbarStyle)?"top":this.view.actionbarStyle),this.options.actionbarStyle||(this.options.actionbarStyle="top"),this.schema.items||(this.schema.items={}),this.options.items||(this.options.items={}),this.schema.items.maxItems&&(this.schema.maxItems=this.schema.items.maxItems,delete this.schema.items.maxItems),this.schema.items.minItems&&(this.schema.minItems=this.schema.items.minItems,delete this.schema.items.minItems),this.schema.items.uniqueItems&&(this.schema.uniqueItems=this.schema.items.uniqueItems,delete this.schema.items.uniqueItems),this.options.rubyrails=!1,this.parent&&this.parent.options&&this.parent.options.form&&this.parent.options.form.attributes&&(p.isEmpty(this.parent.options.form.attributes.rubyrails)||(this.options.rubyrails=!0));t=void 0;if(p.isEmpty(this.view.toolbarSticky)||(t=this.view.toolbarSticky),p.isEmpty(this.options.toolbarSticky)||(t=this.options.toolbarSticky),this.options.toolbarSticky=t,void 0===r.options.hideToolbarWithChildren&&(r.options.hideToolbarWithChildren=!0),this.schema.items&&this.schema.uniqueItems&&p.mergeObject(this.options,{forceRevalidation:!0}),void 0===this.data&&(this.data=[]),null==this.data&&(this.data=[]),""==this.data&&(this.data=[]),p.isString(this.data))try{var e=p.parseJSON(this.data);if(!p.isArray(e)&&!p.isObject(e))return void p.logWarn("ArrayField parsed string data but it was not an array: "+this.data);this.data=e}catch(t){this.data=[this.data]}if(p.isArray(this.data)||p.isObject(this.data)){t=function(t,e,a){var n,i=r.findAction(t,e);for(n in i||t.push(i={core:!0}),a)i[n]||(i[n]=a[n])},e=function(t,e){for(var a=0;void 0===t[a].enabled&&(t[a].enabled=!0),e||delete t[a].label,t[a].enabled?a++:t.splice(a,1),a<t.length;);t.sort(function(t,e){return t.core&&!e.core?-1:!t.core&&e.core?1:0})};if(r.toolbar={},r.options.toolbar)for(var a in r.options.toolbar)r.toolbar[a]=r.options.toolbar[a];if(void 0===r.toolbar.showLabels&&(r.toolbar.showLabels=!0),r.toolbar.actions||(r.toolbar.actions=[]),t(r.toolbar.actions,"add",{label:r.getMessage("addItemButtonLabel"),action:"add",iconClass:r.view.getStyle("addIcon"),click:function(t,e){r.handleToolBarAddItemClick(function(t){})}}),e(r.toolbar.actions,r.toolbar.showLabels),r.actionbar={},r.options.actionbar)for(var n in r.options.actionbar)r.actionbar[n]=r.options.actionbar[n];void 0===r.actionbar.showLabels&&(r.actionbar.showLabels=!1),r.actionbar.actions||(r.actionbar.actions=[]),t(r.actionbar.actions,"add",{label:r.getMessage("addButtonLabel"),action:"add",iconClass:r.view.getStyle("addIcon"),click:function(t,e,a){r.handleActionBarAddItemClick(a,function(t){})}}),t(r.actionbar.actions,"remove",{label:r.getMessage("removeButtonLabel"),action:"remove",iconClass:r.view.getStyle("removeIcon"),click:function(t,e,a){r.handleActionBarRemoveItemClick(a,function(t){})}}),t(r.actionbar.actions,"up",{label:r.getMessage("upButtonLabel"),action:"up",iconClass:r.view.getStyle("upIcon"),click:function(t,e,a){r.handleActionBarMoveItemUpClick(a,function(){})}}),t(r.actionbar.actions,"down",{label:r.getMessage("downButtonLabel"),action:"down",iconClass:r.view.getStyle("downIcon"),click:function(t,e,a){r.handleActionBarMoveItemDownClick(a,function(){})}}),e(r.actionbar.actions,r.actionbar.showLabels);t=this.data.length,e=d.extend(!0,{},this.data);e.length=t,this.data=Array.prototype.slice.call(e)}else p.logWarn("ArrayField data is not an array: "+JSON.stringify(this.data,null,"  "))},setValue:function(r){var o=this;if(r&&p.isArray(r)){var t,l=0;do{}while(l<o.children.length&&(t=o.children[l],r.length>l?(t.setValue(r[l]),l++):o.removeItem(l)),l<o.children.length);l<r.length&&o.resolveItemSchemaOptions(function(n,i,t){if(n||p.logDebug("Unable to resolve schema for item: "+l),t)return p.throwErrorWithCallback("Circular reference detected for schema: "+JSON.stringify(n),o.errorCallback);for(var e=[];l<r.length;){var a=((e,a)=>function(t){o.addItem(e,n,i,a[e],function(){p.nextTick(function(){t()})})})(l,r[l]);e.push(a),l++}p.series(e,function(){})})}},getContainerValue:function(){if(0===this.children.length&&!this.isRequired())return[];for(var t=[],e=0;e<this.children.length;e++){var a=this.children[e].getValue();void 0!==a&&t.push(a)}return t},createItems:function(o){var l=this,s=[];l.data&&0<l.data.length?l.resolveItemSchemaOptions(function(n,i,t){if(t)return p.throwErrorWithCallback("Circular reference detected for schema: "+JSON.stringify(n),l.errorCallback);for(var e=[],a=0;a<l.data.length;a++){var r=((t,a)=>function(e){l.createItem(t,n,i,a,function(t){s.push(t),p.nextTick(function(){e()})})})(a,l.data[a]);e.push(r)}p.series(e,function(t){o(s)})}):o(s)},createItem:function(a,t,e,n,i){var r=this;r._validateEqualMaxItems()&&d("<div></div>").alpaca({data:n,options:e,schema:t,view:this.view.id||this.view,connector:this.connector,error:function(t){r.destroy(),r.errorCallback.call(r,t)},notTopLevel:!0,render:function(t,e){t.parent=r,t.path=r.path+"["+a+"]",t.render(null,function(){r.refreshValidationState(),r.updatePathAndName(),r.triggerUpdate(),e&&e()})},postRender:function(t){var e=p.tmpl(r.containerItemTemplateDescriptor,{id:r.getId(),name:t.name,parentFieldId:r.getId(),actionbarStyle:r.options.actionbarStyle,view:r.view,data:n}),a=(p.logDebug("acioina MARKER5: "+d(e)[0].innerHTML),d(e).find("."+p.MARKER_CLASS_CONTAINER_FIELD_ITEM_FIELD));0===(a=0===a.length&&d(e).hasClass(p.MARKER_CLASS_CONTAINER_FIELD_ITEM_FIELD)?d(e):a).length?r.errorCallback.call(r,{message:"Cannot find insertion point for field: "+r.getId()}):(d(a).before(t.getFieldEl()),d(a).remove(),t.containerItemEl=e,p.fieldApplyFieldAndChildren(t,function(t){t.hideInitValidationError=!1}),p.isFunction(r.options.items.postRender)&&r.options.items.postRender.call(t,a),i&&i(t))}})},resolveItemSchemaOptions:function(n){function l(t,e,a){i.options.readonly&&(e.readonly=!0),n(t,e,a)}var t,e,i=this;if(!(t=!t&&i.options&&i.options.fields&&i.options.fields.item?i.options.fields.item:t)&&i.options&&i.options.items&&(t=i.options.items),(e=i.schema&&i.schema.items?i.schema.items:e)&&e.$ref){for(var s=e.$ref,a=this,c=[a];a.parent;)a=a.parent,c.push(a);var d=e,h=t;p.loadRefSchemaOptions(a,s,function(t,e){for(var a=0,n=0;n<c.length;n++)!c[n].schema||c[n].schema.id!==s&&c[n].schema.id!=="#"+s&&c[n].schema.$ref!==s||a++;var i=10<a,r={},o=(d&&p.mergeObject(r,d),t&&p.mergeObject(r,t),delete r.id,{});h&&p.mergeObject(o,h),e&&p.mergeObject(o,e),p.nextTick(function(){l(r,o,i)})})}else p.nextTick(function(){l(e,t)})},handleValidate:function(){var t=this.base(),e=this.validation,a=this._validateUniqueItems();return e.valueNotUnique={message:a?"":this.getMessage("valueNotUnique"),status:a},a=this._validateMaxItems(),e.tooManyItems={message:a?"":p.substituteTokens(this.getMessage("tooManyItems"),[this.schema.maxItems]),status:a},a=this._validateMinItems(),e.notEnoughItems={message:a?"":p.substituteTokens(this.getMessage("notEnoughItems"),[this.schema.minItems]),status:a},t&&e.valueNotUnique.status&&e.tooManyItems.status&&e.notEnoughItems.status},_validateEqualMaxItems:function(){return!(this.schema.maxItems&&0<=this.schema.maxItems&&this.getSize()>=this.schema.maxItems)},_validateEqualMinItems:function(){return!(this.schema.minItems&&0<=this.schema.minItems&&this.getSize()<=this.schema.minItems)},_validateMinItems:function(){return!(this.schema.minItems&&0<=this.schema.minItems&&this.getSize()<this.schema.minItems)},_validateMaxItems:function(){return!(this.schema.maxItems&&0<=this.schema.maxItems&&this.getSize()>this.schema.maxItems)},_validateUniqueItems:function(){if(this.schema.items&&this.schema.uniqueItems)for(var t={},e=0,a=this.children.length;e<a;++e){if(t.hasOwnProperty(this.children[e]))return!1;t[this.children[e]]=!0}return!0},findAction:function(t,a){var n=null;return d.each(t,function(t,e){e.action==a&&(n=e)}),n},postRender:function(t){this.base(function(){t()})},getSize:function(){return this.children.length},updatePathAndName:function(){function i(a){a.children&&d.each(a.children,function(t,e){a.prePath&&p.startsWith(e.path,a.prePath)&&(e.prePath=e.path,e.path=e.path.replace(a.prePath,a.path)),a.preName&&p.startsWith(e.name,a.preName)&&(e.preName=e.name,e.name=e.name.replace(a.preName,a.name),e.field)&&d(e.field).attr("name",e.name),i(e)})}this.children&&0<this.children.length&&d.each(this.children,function(t,e){var a=e.path.lastIndexOf("/"),n=e.path.substring(a+1);(n=n.indexOf("[")<0&&n.indexOf("]")<0?n.substring(n.indexOf("[")+1,n.indexOf("]")):n)!==t&&(e.prePath=e.path,e.path=e.path.substring(0,a)+"/["+t+"]"),e.nameCalculated&&(e.preName=e.name,e.parent&&e.parent.name&&e.path?e.name=e.parent.name+"_"+t:e.path&&(e.name=e.path.replace(/\//g,"").replace(/\[/g,"_").replace(/\]/g,"")),this.parent.options.rubyrails?d(e.field).attr("name",e.parent.name):d(e.field).attr("name",e.name)),e.prePath||(e.prePath=e.path),i(e)})},updateToolbars:function(){var t,i=this;"display"===this.view.type||this.schema.readonly||(i.toolbar&&(i.fireCallback("arrayToolbar",!0),i.fireCallback("arrayToolbar")),i.actionbar&&(i.fireCallback("arrayActionbars",!0),i.fireCallback("arrayActionbars")),t=d(this.getFieldEl()).find(".alpaca-array-toolbar[data-alpaca-array-toolbar-field-id='"+i.getId()+"']"),0<this.children.length&&i.options.hideToolbarWithChildren?d(t).hide():(d(t).show(),d(t).find("[data-alpaca-array-toolbar-action]").each(function(){var e=d(this).attr("data-alpaca-array-toolbar-action"),a=i.findAction(i.toolbar.actions,e);a&&d(this).off().click(function(t){t.preventDefault(),a.click.call(i,e,a)})})),null==this.options.toolbarSticky?(t=this.getFieldEl().find(".alpaca-container-item[data-alpaca-container-item-parent-field-id='"+i.getId()+"']"),d(t).each(function(t){var e=d(i.getFieldEl()).find(".alpaca-array-actionbar[data-alpaca-array-actionbar-parent-field-id='"+i.getId()+"'][data-alpaca-array-actionbar-item-index='"+t+"']");e&&0<e.length&&(d(this).hover(function(){d(e).show()},function(){d(e).hide()}),d(e).hide())})):this.options.toolbarSticky?d(i.getFieldEl()).find(".alpaca-array-actionbar[data-alpaca-array-actionbar-parent-field-id='"+i.getId()+"']").show():(this.options.toolbarSticky,d(i.getFieldEl()).find(".alpaca-array-actionbar[data-alpaca-array-actionbar-parent-field-id='"+i.getId()+"']").hide()),t=d(i.getFieldEl()).find(".alpaca-array-actionbar[data-alpaca-array-actionbar-parent-field-id='"+i.getId()+"']"),d(t).each(function(){var n=d(this).attr("data-alpaca-array-actionbar-item-index");"string"==typeof n&&(n=parseInt(n,10)),d(this).find("[data-alpaca-array-actionbar-action]").each(function(){var e=d(this).attr("data-alpaca-array-actionbar-action"),a=i.findAction(i.actionbar.actions,e);a&&d(this).off().click(function(t){t.preventDefault(),a.click.call(i,e,a,n)})}),i._validateEqualMaxItems()?(d(this).find("[data-alpaca-array-toolbar-action='add']").each(function(t){d(this).removeClass("alpaca-button-disabled"),i.fireCallback("enableButton",this)}),d(this).find("[data-alpaca-array-actionbar-action='add']").each(function(t){d(this).removeClass("alpaca-button-disabled"),i.fireCallback("enableButton",this)})):(d(this).find("[data-alpaca-array-toolbar-action='add']").each(function(t){d(this).addClass("alpaca-button-disabled"),i.fireCallback("disableButton",this)}),d(this).find("[data-alpaca-array-actionbar-action='add']").each(function(t){d(this).addClass("alpaca-button-disabled"),i.fireCallback("disableButton",this)})),i._validateEqualMinItems()?d(this).find("[data-alpaca-array-actionbar-action='remove']").each(function(t){d(this).removeClass("alpaca-button-disabled"),i.fireCallback("enableButton",this)}):d(this).find("[data-alpaca-array-actionbar-action='remove']").each(function(t){d(this).addClass("alpaca-button-disabled"),i.fireCallback("disableButton",this)})}),d(t).first().find("[data-alpaca-array-actionbar-action='up']").each(function(){d(this).addClass("alpaca-button-disabled"),i.fireCallback("disableButton",this)}),d(t).last().find("[data-alpaca-array-actionbar-action='down']").each(function(){d(this).addClass("alpaca-button-disabled"),i.fireCallback("disableButton",this)}))},doResolveItemContainer:function(){return d(this.container)},handleToolBarAddItemClick:function(i){var r=this;r.resolveItemSchemaOptions(function(t,e,a){if(a)return p.throwErrorWithCallback("Circular reference detected for schema: "+JSON.stringify(t),r.errorCallback);var a=r.children.length,n=p.createEmptyDataInstance(t);r.addItem(a,t,e,n,function(t){i&&i(t)})})},handleActionBarAddItemClick:function(n,i){var r=this;r.resolveItemSchemaOptions(function(t,e,a){if(a)return p.throwErrorWithCallback("Circular reference detected for schema: "+JSON.stringify(t),r.errorCallback);a=p.createEmptyDataInstance(t);r.addItem(n+1,t,e,a,function(t){i&&i(t)})})},handleActionBarRemoveItemClick:function(t,e){this.removeItem(t,function(){e&&e()})},handleActionBarMoveItemUpClick:function(t,e){this.moveItem(t,t-1,this.options.animate,function(){e&&e()})},handleActionBarMoveItemDownClick:function(t,e){this.moveItem(t,t+1,this.options.animate,function(){e&&e()})},doAddItem:function(t,e){var a=this.doResolveItemContainer();0===t?d(a).append(e.containerItemEl):(a=a.children("[data-alpaca-container-item-index='"+(t-1)+"']"))&&0<a.length&&a.after(e.containerItemEl),this.doAfterAddItem(e)},doAfterAddItem:function(t){},addItem:function(e,t,a,n,i){var r=this;r._validateEqualMaxItems()&&r.createItem(e,t,a,n,function(t){r.registerChild(t,e),r.doAddItem(e,t),r.handleRepositionDOMRefresh(),r.refreshValidationState(),r.trigger("add",t),r.triggerUpdate(),i&&i(t)})},doRemoveItem:function(t){this.doResolveItemContainer().children(".alpaca-container-item[data-alpaca-container-item-index='"+t+"']").remove()},removeItem:function(t,e){var a=this;this._validateEqualMinItems()&&(a.unregisterChild(t),a.doRemoveItem(t),a.handleRepositionDOMRefresh(),a.refreshValidationState(),a.trigger("remove",t),a.triggerUpdate(),e)&&e()},moveItem:function(a,n,t,i){var e,r,o,l,s,c=this;"function"==typeof t&&(i=t,t=c.options.animate),void 0===t&&(t=c.options.animate||!0),"string"==typeof a&&(a=parseInt(a,10)),-1!==(n=(n=(n="string"==typeof n?parseInt(n,10):n)<0?0:n)>=c.children.length?c.children.length-1:n)&&a!==n&&c.children[n]&&(e=c.getId(),r=c.getContainerEl().find(".alpaca-container-item[data-alpaca-container-item-index='"+a+"'][data-alpaca-container-item-parent-field-id='"+e+"']"),o=c.getContainerEl().find(".alpaca-container-item[data-alpaca-container-item-index='"+n+"'][data-alpaca-container-item-parent-field-id='"+e+"']"),l=d("<div class='tempMarker1'></div>"),r.before(l),s=d("<div class='tempMarker2'></div>"),o.before(s),p.animatedSwap(r,o,t?500:0,function(){for(var t=[],e=0;e<c.children.length;e++)t[e]=e===a?c.children[n]:e===n?c.children[a]:c.children[e];c.children=t,l.replaceWith(o),s.replaceWith(r),c.handleRepositionDOMRefresh(),d(r).find(".alpaca-container-item[data-alpaca-array-actionbar-item-index='"+a+"'][data-alpaca-container-item-parent-field-id='"+c.getId()+"']").attr("data-alpaca-array-actionbar-item-index",n),d(o).find(".alpaca-container-item[data-alpaca-array-actionbar-item-index='"+n+"'][data-alpaca-container-item-parent-field-id='"+c.getId()+"']").attr("data-alpaca-array-actionbar-item-index",a),c.refreshValidationState(),c.triggerUpdate(),c.trigger("move"),i&&i()}))},getType:function(){return"array"},getTitle:function(){return"Array Field"},getDescription:function(){return"Field for list of items with same data type or structure."},getSchemaOfSchema:function(){var t={properties:{items:{title:"Array Items",description:"Schema for array items.",type:"object"},minItems:{title:"Minimum Items",description:"Minimum number of items.",type:"number"},maxItems:{title:"Maximum Items",description:"Maximum number of items.",type:"number"},uniqueItems:{title:"Items Unique",description:"Item values should be unique if true.",type:"boolean",default:!1}}};return this.children&&this.children[0]&&p.merge(t.properties.items.properties,this.children[0].getSchemaOfSchema()),p.merge(this.base(),t)},getSchemaOfOptions:function(){var t={properties:{toolbarSticky:{title:"Sticky Toolbar",description:"If true, the array item toolbar will always be enabled.  If false, the toolbar is always disabled.  If undefined or null, the toolbar will appear when hovered over.",type:"boolean",default:void 0},toolbarStyle:{title:"Toolbar Style",description:"The kind of top-level toolbar to render for the array field.  Either 'button' or 'link'.",type:"string",default:"button"},actionbarStyle:{title:"Actionbar Style",description:"The kind of actionbar to render for each item in the array.  Either 'top', 'bottom', 'left', or 'right'.",type:"string",default:"top"},toolbar:{type:"object",title:"Toolbar Configuration",properties:{showLabels:{type:"boolean",default:!0,title:"Whether to show labels next to actions"},actions:{type:"array",title:"Toolbar Actions Configuration",items:{action:{type:"string",title:"Action Key"},label:{type:"string",title:"Action Label"},iconClass:{type:"string",title:"Action CSS Classes for Icon"},click:{type:"function",title:"Action Click Handler"},enabled:{type:"boolean",title:"Whether to enable the action",default:!0}}}}},actionbar:{type:"object",properties:{showLabels:{type:"boolean",default:!1,title:"Whether to show labels next to actions"},actions:{type:"array",title:"Actions Bar Actions Configuration",items:{action:{type:"string",title:"Action Key"},label:{type:"string",title:"Action Label"},iconClass:{type:"string",title:"Action CSS Classes for Icon"},click:{type:"function",title:"Action Click Handler"},enabled:{type:"boolean",title:"Whether to enable the action",default:!0}}}}},hideToolbarWithChildren:{type:"boolean",title:"Hide Toolbar with Children",description:"Indicates whether to hide the top toolbar when child elements are available.",default:!0}}};return this.children&&this.children[0]&&p.merge(t.properties.items.properties,this.children[0].getSchemaOfSchema()),p.merge(this.base(),t)}}),p.registerFieldClass("array",p.Fields.ArrayField),p.registerDefaultSchemaFieldMapping("array","array"),n=jQuery,(i=n.alpaca).Fields.MapField=i.Fields.ArrayField.extend({getFieldType:function(){return"map"},getType:function(){return"object"},setup:function(){var a;this.data&&i.isObject(this.data)&&(a=[],n.each(this.data,function(t,e){e=i.copyOf(e);e._key=t,a.push(e)}),this.data=a),this.base(),i.mergeObject(this.options,{forceRevalidation:!0}),i.isEmpty(this.data)},getContainerValue:function(){if(0!==this.children.length||this.isRequired()){for(var t={},e=0;e<this.children.length;e++){var a=this.children[e].getValue(),n=a._key;n&&(delete a._key,t[n]=a)}return t}},handleValidate:function(){var t=this.base(),e=this.validation,a=this._validateMapKeysNotEmpty(),a=(e.keyMissing={message:a?"":this.getMessage("keyMissing"),status:a},this._validateMapKeysUnique());return e.keyNotUnique={message:a?"":this.getMessage("keyNotUnique"),status:a},t&&e.keyMissing.status&&e.keyNotUnique.status},_validateMapKeysNotEmpty:function(){for(var t=!0,e=0;e<this.children.length;e++)if(!this.children[e].getValue()._key){t=!1;break}return t},_validateMapKeysUnique:function(){for(var t=!0,e={},a=0;a<this.children.length;a++){var n=this.children[a].getValue()._key;e[n]&&(t=!1),e[n]=n}return t},getTitle:function(){return"Map Field"},getDescription:function(){return"Field for objects with key/value pairs that share the same schema for values."}}),i.registerFieldClass("map",i.Fields.MapField),Alpaca});